<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–µ—Ä–µ–∂–∞–Ω–∏ Weather Live</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --blue: #8ab4f8; --amber: #ff9800; --bg: #0b1120; --glass: rgba(255, 255, 255, 0.05); }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; padding: 20px 10px; overflow-x: hidden; }
        .snow-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background: url('https://www.transparenttextures.com/patterns/snow.png'); animation: snowFall 25s linear infinite; opacity: 0.15; z-index: 1; }
        @keyframes snowFall { from { background-position: 0 0; } to { background-position: 500px 1000px; } }

        .app-card { position: relative; z-index: 10; width: 100%; max-width: 500px; background: rgba(25, 25, 30, 0.98); backdrop-filter: blur(20px); border-radius: 30px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 50px rgba(0,0,0,0.6); }
        .storm-warning { border-color: var(--amber) !important; animation: warning-glow 2s infinite; }
        @keyframes warning-glow { 50% { box-shadow: 0 0 30px rgba(255, 152, 0, 0.5); border-color: var(--amber); } }

        .header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .refresh-btn { background: rgba(255,255,255,0.1); border: none; color: white; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; }
        .refresh-btn i.rotating { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .advice-box { background: rgba(138, 180, 248, 0.1); padding: 15px; border-radius: 18px; border-left: 5px solid var(--blue); margin-bottom: 20px; font-size: 0.88rem; line-height: 1.4; }
        .astro-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .astro-item { background: var(--glass); padding: 12px; border-radius: 15px; font-size: 0.75rem; }
        .astro-item b { color: var(--blue); display: block; margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); }

        .hero { display: flex; align-items: center; gap: 20px; margin: 15px 0; }
        .temp-main { font-size: 5rem; font-weight: 200; }
        .main-icon { font-size: 3.5rem; color: var(--blue); }

        .press-box { background: rgba(0,0,0,0.25); border-radius: 20px; padding: 15px; margin: 20px 0; font-size: 0.8rem; }
        .tabs { display: flex; justify-content: flex-end; gap: 8px; border-bottom: 1px solid #333; padding-bottom: 12px; margin-bottom: 20px; }
        .tab-btn { background: none; border: 1px solid #444; color: #888; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.82rem; }
        .tab-btn.active { background: var(--blue); color: black; font-weight: bold; }

        .hourly { display: flex; overflow-x: auto; gap: 25px; padding-bottom: 15px; scrollbar-width: none; }
        .h-card { text-align: center; min-width: 65px; }
        .weekly { background: rgba(0,0,0,0.2); border-radius: 25px; padding: 10px 15px; }
        .w-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #333; font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="snow-overlay"></div>
    <div class="app-card" id="weather-card">
        <div class="header">
            <div><b>–ë–µ—Ä–µ–∂–∞–Ω–∏</b><br><small id="cur-date" style="opacity:0.6;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</small></div>
            <button class="refresh-btn" onclick="fetchWeatherData()"><i id="sync-icon" class="fa-solid fa-rotate"></i></button>
        </div>
        <div class="advice-box" id="advice">–û—Ç—Ä–∏–º—É—é –¥–∞–Ω—ñ –∑ –º–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü—ñ—ó...</div>
        <div class="astro-grid">
            <div class="astro-item"><b>üåÖ –°–æ–Ω—Ü–µ</b>–°—Ö—ñ–¥: <span id="sunrise">--:--</span><br>–ó–∞—Ö—ñ–¥: <span id="sunset">--:--</span></div>
            <div class="astro-item"><b>üåô –ú—ñ—Å—è—Ü—å</b>–§–∞–∑–∞: <span id="moon">--</span><br>–¢–∏—Å–∫: <span id="press-val">--</span></div>
        </div>
        <div class="hero">
            <div class="temp-main" id="m-temp">--¬∞</div>
            <i class="fa-solid fa-cloud main-icon" id="m-icon"></i>
        </div>
        <div id="m-desc" style="font-size: 1.3rem; margin-bottom: 5px;">--</div>
        <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 20px;">
            –í—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è —è–∫ <span id="feels-like">--</span> ‚Ä¢ –í—ñ—Ç–µ—Ä <span id="wind-main">--</span> –º/—Å
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="renderHourly('temp', this)">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</button>
            <button class="tab-btn" onclick="renderHourly('precip', this)">–û–ø–∞–¥–∏</button>
        </div>
        <div class="hourly" id="hour-list"></div>
        <div style="margin: 25px 0 10px; font-weight: bold; color: var(--blue); font-size: 0.9rem;">–ü–†–û–ì–ù–û–ó –ù–ê –¢–ò–ñ–î–ï–ù–¨</div>
        <div class="weekly" id="week-list"></div>
    </div>

    <script>
        const weatherCodes = {
            0: {t: "–Ø—Å–Ω–æ", i: "fa-sun"}, 1: {t: "–ü–µ—Ä–µ–≤–∞–∂–Ω–æ —è—Å–Ω–æ", i: "fa-cloud-sun"},
            2: {t: "–ú—ñ–Ω–ª–∏–≤–∞ —Ö–º–∞—Ä–Ω—ñ—Å—Ç—å", i: "fa-cloud-sun"}, 3: {t: "–•–º–∞—Ä–Ω–æ", i: "fa-cloud"},
            45: {t: "–¢—É–º–∞–Ω", i: "fa-smog"}, 48: {t: "–ü–∞–º–æ—Ä–æ–∑—å", i: "fa-smog"},
            51: {t: "–ú—Ä—è–∫–∞", i: "fa-cloud-rain"}, 61: {t: "–ù–µ–≤–µ–ª–∏–∫–∏–π –¥–æ—â", i: "fa-cloud-rain"},
            71: {t: "–ù–µ–≤–µ–ª–∏–∫–∏–π —Å–Ω—ñ–≥", i: "fa-snowflake"}, 73: {t: "–°–Ω—ñ–≥", i: "fa-snowflake"},
            75: {t: "–°–∏–ª—å–Ω–∏–π —Å–Ω—ñ–≥", i: "fa-snowflake"}, 95: {t: "–ì—Ä–æ–∑–∞", i: "fa-bolt"}
        };

        let rawData = null;

        async function fetchWeatherData() {
            const icon = document.getElementById('sync-icon');
            icon.classList.add('rotating');
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=49.4452&longitude=24.9332&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,weather_code,surface_pressure,wind_speed_10m&hourly=temperature_2m,precipitation_probability,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset&timezone=auto`;
                const response = await fetch(url);
                rawData = await response.json();
                updateUI();
            } catch (e) {
                document.getElementById('advice').innerText = "–ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ —Å—É–ø—É—Ç–Ω–∏–∫–æ–º.";
            }
            setTimeout(() => icon.classList.remove('rotating'), 1000);
        }

        function updateUI() {
            const cur = rawData.current;
            const daily = rawData.daily;
            const code = weatherCodes[cur.weather_code] || {t: "–ù–µ–≤—ñ–¥–æ–º–æ", i: "fa-cloud"};

            document.getElementById('cur-date').innerText = new Date().toLocaleDateString('uk-UA', {weekday: 'long', day: 'numeric', month: 'long'});
            document.getElementById('m-temp').innerText = Math.round(cur.temperature_2m) + "¬∞";
            document.getElementById('feels-like').innerText = Math.round(cur.apparent_temperature) + "¬∞";
            document.getElementById('press-val').innerText = Math.round(cur.surface_pressure * 0.75006) + " –º–º";
            document.getElementById('m-desc').innerText = code.t;
            document.getElementById('m-icon').className = `fa-solid ${code.i} main-icon`;
            document.getElementById('wind-main').innerText = Math.round(cur.wind_speed_10m);
            document.getElementById('sunrise').innerText = daily.sunrise[0].split('T')[1];
            document.getElementById('sunset').innerText = daily.sunset[0].split('T')[1];

            // Amber Alert logic
            const card = document.getElementById('weather-card');
            if (cur.temperature_2m < -10 || cur.weather_code >= 71) {
                card.classList.add('storm-warning');
                document.getElementById('advice').innerHTML = "<b>–£–í–ê–ì–ê:</b> –°–∫–ª–∞–¥–Ω—ñ –ø–æ–≥–æ–¥–Ω—ñ —É–º–æ–≤–∏! –ë—É–¥—å—Ç–µ –æ–±–µ—Ä–µ–∂–Ω—ñ.";
            } else {
                card.classList.remove('storm-warning');
                document.getElementById('advice').innerText = "–£ –ë–µ—Ä–µ–∂–∞–Ω–∞—Ö –ø–æ–≥–æ–¥–∞ —Å–ø–æ–∫—ñ–π–Ω–∞. –ì–∞—Ä–Ω–æ–≥–æ –¥–Ω—è!";
            }

            // Week
            const wList = document.getElementById('week-list');
            wList.innerHTML = '';
            for(let i=0; i<7; i++) {
                const dayCode = weatherCodes[daily.weather_code[i]] || {t: "–•–º–∞—Ä–Ω–æ", i: "fa-cloud"};
                wList.innerHTML += `<div class="w-row">
                    <span style="width:35px;">${new Date(daily.time[i]).toLocaleDateString('uk-UA', {weekday: 'short'})}</span>
                    <i class="fa-solid ${dayCode.i}" style="color:var(--blue); width:20px;"></i>
                    <span style="flex:1; margin-left:15px; opacity:0.7;">${dayCode.t}</span>
                    <b>${Math.round(daily.temperature_2m_max[i])}¬∞ / ${Math.round(daily.temperature_2m_min[i])}¬∞</b>
                </div>`;
            }
            renderHourly('temp', document.querySelector('.tab-btn'));
        }

        function renderHourly(mode, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const list = document.getElementById('hour-list');
            list.innerHTML = '';
            const now = new Date().getHours();
            
            for(let i=now; i<now+12; i++) {
                const time = rawData.hourly.time[i].split('T')[1];
                const hCode = weatherCodes[rawData.hourly.weather_code[i]] || {i: "fa-cloud"};
                let val = mode === 'temp' ? `<b>${Math.round(rawData.hourly.temperature_2m[i])}¬∞</b>` : `<span style="color:var(--blue); font-weight:bold;">${rawData.hourly.precipitation_probability[i]}%</span>`;
                list.innerHTML += `<div class="h-card"><div>${time}</div><i class="fa-solid ${hCode.i}" style="margin:8px 0; color:var(--blue); opacity:0.6;"></i><br>${val}</div>`;
            }
        }

        window.onload = fetchWeatherData;
    </script>
</body>
</html>
