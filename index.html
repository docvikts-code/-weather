<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–µ—Ä–µ–∂–∞–Ω–∏ –ü–æ–≥–æ–¥–∞ Live</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --blue: #8ab4f8; --amber: #ff9800; --bg: #0b1120; --glass: rgba(255, 255, 255, 0.05); }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; padding: 20px 10px; overflow-x: hidden; }
        
        .snow-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background: url('https://www.transparenttextures.com/patterns/snow.png'); animation: snowFall 25s linear infinite; opacity: 0.15; z-index: 1; }
        @keyframes snowFall { from { background-position: 0 0; } to { background-position: 500px 1000px; } }

        .app-card { position: relative; z-index: 10; width: 100%; max-width: 500px; background: rgba(25, 25, 30, 0.98); border-radius: 30px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 50px rgba(0,0,0,0.6); transition: border 0.5s; }
        .storm-warning { border-color: var(--amber) !important; animation: warning-glow 2s infinite; }
        @keyframes warning-glow { 50% { box-shadow: 0 0 30px rgba(255, 152, 0, 0.4); border-color: var(--amber); } }

        .header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .refresh-btn { background: rgba(255,255,255,0.1); border: none; color: white; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .refresh-btn i.rotating { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .advice-box { background: rgba(138, 180, 248, 0.1); padding: 15px; border-radius: 18px; border-left: 5px solid var(--blue); margin-bottom: 20px; font-size: 0.88rem; line-height: 1.4; }
        .astro-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .astro-item { background: var(--glass); padding: 12px; border-radius: 15px; font-size: 0.75rem; }
        .astro-item b { color: var(--blue); display: block; margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.1); }

        .hero { display: flex; align-items: center; gap: 20px; margin: 15px 0; }
        .temp-main { font-size: 5rem; font-weight: 200; }
        .main-icon { font-size: 3.5rem; color: var(--blue); }

        .tabs { display: flex; justify-content: flex-end; gap: 8px; border-bottom: 1px solid #333; padding-bottom: 12px; margin-bottom: 20px; }
        .tab-btn { background: none; border: 1px solid #444; color: #888; padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; outline: none; transition: 0.3s; }
        .tab-btn.active { background: var(--blue); color: black; font-weight: bold; border-color: var(--blue); }

        .hourly { display: flex; overflow-x: auto; gap: 25px; padding-bottom: 15px; scrollbar-width: none; }
        .hourly::-webkit-scrollbar { display: none; }
        .h-card { text-align: center; min-width: 65px; }

        .weekly { background: rgba(0,0,0,0.2); border-radius: 25px; padding: 10px 15px; }
        .w-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #333; font-size: 0.85rem; }
        .w-row:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="snow-overlay"></div>
    <div class="app-card" id="weather-card">
        <div class="header">
            <div><b>–ë–µ—Ä–µ–∂–∞–Ω–∏</b><br><small id="cur-date" style="opacity:0.6;">–û–Ω–æ–≤–ª–µ–Ω–Ω—è...</small></div>
            <button class="refresh-btn" onclick="fetchWeatherData()" title="–û–Ω–æ–≤–∏—Ç–∏">
                <i id="sync-icon" class="fa-solid fa-rotate"></i>
            </button>
        </div>

        <div class="advice-box" id="advice">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –º–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü—ñ—ó...</div>

        <div class="astro-grid">
            <div class="astro-item" id="astro-sun">
                <b>üåÖ –°–æ–Ω—Ü–µ</b>
                –°—Ö—ñ–¥ –°–æ–Ω—Ü—è: <span id="sunrise">--:--</span><br>
                –ó–∞—Ö—ñ–¥ –°–æ–Ω—Ü—è: <span id="sunset">--:--</span>
            </div>
            <div class="astro-item" id="astro-extra">
                <b>üíß –î–µ—Ç–∞–ª—ñ</b>
                –¢–∏—Å–∫: <span id="press-val">--</span><br>
                –í–æ–ª–æ–≥—ñ—Å—Ç—å: <span id="hum-val">--</span>
            </div>
        </div>

        <div class="hero">
            <div class="temp-main" id="m-temp">--¬∞</div>
            <i class="fa-solid fa-cloud main-icon" id="m-icon"></i>
        </div>
        <div id="m-desc" style="font-size: 1.3rem; margin-bottom: 5px;">–ê–Ω–∞–ª—ñ–∑ –Ω–µ–±–∞...</div>
        <div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 20px;">
            –í—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è —è–∫ <span id="feels-like">--</span> ‚Ä¢ –í—ñ—Ç–µ—Ä <span id="wind-main">--</span> –∫–º/–≥–æ–¥
        </div>
        
        <div class="tabs">
            <button class="tab-btn active" id="tab-temp" onclick="changeTab('temp')">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</button>
            <button class="tab-btn" id="tab-precip" onclick="changeTab('precip')">–û–ø–∞–¥–∏</button>
            <button class="tab-btn" id="tab-wind" onclick="changeTab('wind')">–í—ñ—Ç–µ—Ä</button>
        </div>
        
        <div class="hourly" id="hour-list"></div>

        <div style="margin: 25px 0 10px; font-weight: bold; color: var(--blue); font-size: 0.9rem;">–ü–†–û–ì–ù–û–ó –ù–ê –¢–ò–ñ–î–ï–ù–¨</div>
        <div class="weekly" id="week-list"></div>
    </div>

    <script>
        const weatherCodes = {
            0: {t: "–Ø—Å–Ω–æ", i: "fa-sun"}, 1: {t: "–ü–µ—Ä–µ–≤–∞–∂–Ω–æ —è—Å–Ω–æ", i: "fa-cloud-sun"},
            2: {t: "–ú—ñ–Ω–ª–∏–≤–∞ —Ö–º–∞—Ä–Ω—ñ—Å—Ç—å", i: "fa-cloud-sun"}, 3: {t: "–•–º–∞—Ä–Ω–æ", i: "fa-cloud"},
            45: {t: "–¢—É–º–∞–Ω", i: "fa-smog"}, 48: {t: "–ü–∞–º–æ—Ä–æ–∑—å", i: "fa-smog"},
            51: {t: "–ú—Ä—è–∫–∞", i: "fa-cloud-rain"}, 61: {t: "–î–æ—â", i: "fa-cloud-rain"},
            71: {t: "–ù–µ–≤–µ–ª–∏–∫–∏–π —Å–Ω—ñ–≥", i: "fa-snowflake"}, 73: {t: "–°–Ω—ñ–≥", i: "fa-snowflake"},
            75: {t: "–°–∏–ª—å–Ω–∏–π —Å–Ω—ñ–≥", i: "fa-snowflake"}, 95: {t: "–ì—Ä–æ–∑–∞", i: "fa-bolt"}
        };

        let rawData = null;
        let currentTab = 'temp';

        async function fetchWeatherData() {
            const icon = document.getElementById('sync-icon');
            icon.classList.add('rotating');
            document.getElementById('advice').innerText = "–û–Ω–æ–≤–ª—é—é –¥–∞–Ω—ñ...";

            try {
                // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ë–µ—Ä–µ–∂–∞–Ω
                const lat = 49.4452, lon = 24.9332;
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,weather_code,surface_pressure,wind_speed_10m&hourly=temperature_2m,precipitation_probability,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset&timezone=auto`;
                
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network error');
                rawData = await response.json();
                
                updateUI();
            } catch (e) {
                console.error(e);
                document.getElementById('advice').innerHTML = "<span style='color:red;'>‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.</span>";
            } finally {
                setTimeout(() => icon.classList.remove('rotating'), 1000);
            }
        }

        function updateUI() {
            if (!rawData) return;
            const cur = rawData.current;
            const daily = rawData.daily;
            const code = weatherCodes[cur.weather_code] || {t: "–•–º–∞—Ä–Ω–æ", i: "fa-cloud"};

            // –î–∞—Ç–∞ —Ç–∞ –ì–æ–ª–æ–≤–Ω–µ
            document.getElementById('cur-date').innerText = new Date().toLocaleDateString('uk-UA', {weekday: 'long', day: 'numeric', month: 'long'});
            document.getElementById('m-temp').innerText = Math.round(cur.temperature_2m) + "¬∞";
            document.getElementById('feels-like').innerText = Math.round(cur.apparent_temperature) + "¬∞";
            document.getElementById('m-desc').innerText = code.t;
            document.getElementById('m-icon').className = `fa-solid ${code.i} main-icon`;
            
            // –ê—Å—Ç—Ä–æ–Ω–æ–º—ñ—è —Ç–∞ –¥–µ—Ç–∞–ª—ñ
            document.getElementById('sunrise').innerText = daily.sunrise[0].split('T')[1];
            document.getElementById('sunset').innerText = daily.sunset[0].split('T')[1];
            document.getElementById('press-val').innerText = Math.round(cur.surface_pressure * 0.75006) + " –º–º";
            document.getElementById('hum-val').innerText = cur.relative_humidity_2m + "%";
            document.getElementById('wind-main').innerText = Math.round(cur.wind_speed_10m);

            // –ü–æ—Ä–∞–¥–∏ —Ç–∞ Amber Alert
            const card = document.getElementById('weather-card');
            if (cur.temperature_2m < -10 || cur.weather_code >= 71) {
                card.classList.add('storm-warning');
                document.getElementById('advice').innerHTML = "<b>–£–í–ê–ì–ê:</b> –°–∫–ª–∞–¥–Ω—ñ –ø–æ–≥–æ–¥–Ω—ñ —É–º–æ–≤–∏ –≤ –ë–µ—Ä–µ–∂–∞–Ω–∞—Ö! –ë—É–¥—å—Ç–µ –≤–∫—Ä–∞–π –æ–±–µ—Ä–µ–∂–Ω—ñ.";
            } else {
                card.classList.remove('storm-warning');
                document.getElementById('advice').innerText = "–ü–æ–≥–æ–¥–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞. –ì–∞—Ä–Ω–æ–≥–æ –¥–Ω—è!";
            }

            // –†–µ–Ω–¥–µ—Ä —Ç–∏–∂–Ω—è
            const wList = document.getElementById('week-list');
            wList.innerHTML = '';
            for(let i=0; i<7; i++) {
                const dayCode = weatherCodes[daily.weather_code[i]] || {t: "–•–º–∞—Ä–Ω–æ", i: "fa-cloud"};
                wList.innerHTML += `<div class="w-row">
                    <span style="width:35px; font-weight:bold;">${new Date(daily.time[i]).toLocaleDateString('uk-UA', {weekday: 'short'})}</span>
                    <i class="fa-solid ${dayCode.i}" style="color:var(--blue); width:20px; text-align:center;"></i>
                    <span style="flex:1; margin-left:15px; opacity:0.8;">${dayCode.t}</span>
                    <b>${Math.round(daily.temperature_2m_max[i])}¬∞ / ${Math.round(daily.temperature_2m_min[i])}¬∞</b>
                </div>`;
            }

            renderHourly();
        }

        function changeTab(mode) {
            currentTab = mode;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + mode).classList.add('active');
            renderHourly();
        }

        function renderHourly() {
            if (!rawData) return;
            const list = document.getElementById('hour-list');
            list.innerHTML = '';
            
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —ñ–Ω–¥–µ–∫—Å –ø–æ—Ç–æ—á–Ω–æ—ó –≥–æ–¥–∏–Ω–∏ –≤ –º–∞—Å–∏–≤—ñ API
            const nowISO = new Date().toISOString().substring(0, 13);
            let startIdx = rawData.hourly.time.findIndex(t => t.includes(nowISO));
            if (startIdx === -1) startIdx = 0;

            for(let i = startIdx; i < startIdx + 14; i++) {
                if (!rawData.hourly.time[i]) break;
                
                const time = rawData.hourly.time[i].split('T')[1];
                const hCode = weatherCodes[rawData.hourly.weather_code[i]] || {i: "fa-cloud"};
                let val = "";
                
                if(currentTab === 'temp') {
                    val = `<b>${Math.round(rawData.hourly.temperature_2m[i])}¬∞</b>`;
                } else if(currentTab === 'precip') {
                    const prob = rawData.hourly.precipitation_probability[i];
                    val = `<div style="color:var(--blue); font-weight:bold; font-size:0.75rem;">${prob}%</div>
                           <div style="height:25px; display:flex; align-items:flex-end; justify-content:center; margin:4px 0;">
                                <div style="width:10px; background:var(--blue); border-radius:2px; height:${prob/4 + 2}px"></div>
                           </div>`;
                } else if(currentTab === 'wind') {
                    val = `<i class="fa-solid fa-location-arrow" style="transform:rotate(45deg); font-size:0.7rem; color:var(--blue); margin-bottom:5px;"></i><br>
                           <b>${Math.round(rawData.hourly.wind_speed_10m[i])}</b> <small>–∫–º/–≥</small>`;
                }

                list.innerHTML += `
                    <div class="h-card">
                        <div style="font-size:0.7rem; opacity:0.6;">${time}</div>
                        <i class="fa-solid ${hCode.i}" style="margin:10px 0; color:var(--blue); font-size:1.1rem;"></i><br>
                        ${val}
                    </div>`;
            }
        }

        window.onload = fetchWeatherData;
    </script>
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ!', reg))
        .catch(err => console.log('–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó SW:', err));
    });
  }
</script>
</body>
</html>

